name: validate

concurrency:
    group: ${{ github.workflow }}-${{ github.ref }}
    cancel-in-progress: true

on:
    workflow_dispatch:
    push:
        branches:
            - "main"
            - "v[0-9]*"
        tags:
            - "v*"
    pull_request:
        paths-ignore:
            - ".github/releases.json"

jobs:
    validate:
        runs-on: ubuntu-22.04
        strategy:
            fail-fast: false
            matrix:
                target:
                    - lint
                    - validate-vendor
                    - validate-docs
                    - validate-gen
                    - validate-authors
        steps:
            - name: Checkout
              uses: actions/checkout@v3
            - name: Install just
              uses: taiki-e/install-action@just
            - name: Set up Docker Buildx
              uses: docker/setup-buildx-action@v2
              with:
                  version: latest
            - name: Run
              run: |
                  just ${{ matrix.target }}
